# 一、前提

## 1、测试背景

​	通过对优化后的MVC应用测试可知，单台固定配置的服务器所能承受的并发量十分有限，为了能承受更大的并发量，需要对该项目做集群优化，使用多台配置相同的服务器来共同处理。

## 2、测试目的

并发访问集群部署后的MVC项目，观测其并发承载量是否得到有效提升。

# 二、测试准备

## 1、测试环境

### 1、服务器信息

本次集群采用3台配置相同的阿里云ECS服务器进行处理，具体如下：

| 服务器/数据 |     IP地址     |  服务器地址   |
| :---------: | :------------: | :-----------: |
|   服务器1   | 120.78.59.162  | 华南1（深圳） |
|   服务器2   | 47.101.189.171 | 华东2（上海） |
|   服务器3   | 47.101.214.48  | 华东2（上海） |

配置如下：

- 服务器：阿里云ECS云服务器
- 运行系统：CentOS 7.3 64位
- CPU：1 vCPU
- 内存：2GB(IO优化)
- 带宽：15 MBbps	
- JDK：1.8.0_151
- JVM：Java HotSpot(TM) 64-Bit Server VM

### 2、集群信息

本次集群使用Nginx做反向代理和负载均衡，考虑到Session共享、数据一致性等原因，增加 Redis 哨兵集群做分布式缓存和Session管理，详情请看**《6、MVC应用集群优化方案》**。

- 集群信息

![](/images/集群压力测试/BootAdmin集群信息.png)

- 集群组件分布

|  服务端口/服务器  | 服务器1：120.78.59.162 | 服务器2：120.78.59.162 | 服务器3：47.101.189.171 |
| :---------------: | :--------------------: | :--------------------: | :---------------------: |
| BootAdmin监控端口 |          9999          |           /            |            /            |
|     Nginx端口     |          8080          |           /            |            /            |
|     Mysql端口     |          3308          |           /            |            /            |
|   Redis节点端口   |   6379（默认master）   |          6379          |          6379           |
|   Redis哨兵端口   |         26379          |         26379          |          26379          |
|    MVC应用端口    |          8888          |          8888          |          8888           |

Redis集群信息：

![](/images/集群压力测试/Redis集群信息.png)

Sentinel信息：

![](/images/集群压力测试/Sentinel集群信息.png)



由上面的节点分布可知，服务器1又要跑监控，又要跑数据库，还要跑Nginx，压力比较大，所以我对 Nginx 的权重配置如下，希望测试期间由服务器2和服务器3来承受大部分请求，以此来减轻服务1的测试压力：

```shell
#服务器的集群        
upstream  gtaduation.com {  #服务器集群名字     
	#服务器weight是权重的意思，权重越大，分配的概率越大。  
	server    120.78.59.162:8888  weight=20; #服务器1
    server    47.101.189.171:8888  weight=40;#服务器2
    server    47.101.214.48:8888  weight=40;#服务器3
}
```



### 3、项目结构

![](/images/集群方案/MVC集群.png)

## 2、被测对象

- 系统：graduation-project-mvc-cluster（集群版MVC项目）
- 接口：http://120.78.59.162:8080/newsInfo/list
- 接口数据：

![](/images/集群压力测试/测试数据.png)

## 3、测试工具

  Apache-JMeter（5.1.1 r1855137）

# 三、测试计划

### 1、测试计划

由于在对优化后的单体MVC应用做压力测试时，线程组的线程数达到20以后，CPU的使用率就达到100%了，导致服务器的最高吞吐量只有63次/秒左右。

​	现在将三台相同配置的服务器进行集群，理论上来说性能单台服务器的3倍，根据单台服务器测试得出的吞吐量，本次测试制定了如下的测试计划，测试过程中观测各服务器信息，若服务器没崩溃、测试没产生异常、服务器的某项资源没有被用尽，且平均响应时间在2秒以内，就按以下计划进行测试，否则停止测试，并记录、分析测试结果：

|          |                被测接口                 | 并发量 |
| :------: | :-------------------------------------: | :----: |
| 第一阶段 | http://120.78.59.162:8082/newsInfo/list |   50   |
| 第二阶段 | http://120.78.59.162:8082/newsInfo/list |  100   |
| 第三阶段 | http://120.78.59.162:8082/newsInfo/list |  150   |
| 第四阶段 | http://120.78.59.162:8082/newsInfo/list |  200   |
| 第五阶段 | http://120.78.59.162:8082/newsInfo/list |  300   |
| 第六阶段 | http://120.78.59.162:8082/newsInfo/list |  500   |

注意事项：

​	1、在JMeter的线程组配置时，为了避免短时间内启动的线程太多给测试带来不必要的影响，故每个线程的创建至少要预留1秒时间，如50线程的线程组，启动时间至少是50秒，100线程的线程组，启动时间至少是服务器的承受范围之内，以此类推。

​	2、在下一阶段测试开始前，需要重启服务器，避免上一次测试带来的影响。

参考：

​	[JMeter之Ramp-up Period（in seconds）说明](https://www.cnblogs.com/hjhsysu/p/9189897.html)



### 2、测试数据维度

- URL请求信息
- 运行线程信息
- CPU信息
- ECS服务器信息
- JMeter测试结果	

说明：

因为是并发压力测试，所以本测试重点观测以上列出的维度信息，不再对SQL、GC等优化相关的维度进行记录。

# 四、测试

## 1、获取平均响应时间

### 1、线程组配置

![](/images/集群压力测试/平均响应时间/线程组配置.png)

说明：

​	1、线程数：5 个

​	2、总启动时间：10 s

​	3、由于优化后响应时间大幅缩短，为了保证数据的真实性，根据测试理论，我需要增大循环次数

​		为了获取准确的平均响应时间，我将循环次数设为：**1000 次**

### 2、HTTP配置

![](/images/集群压力测试/平均响应时间/HTTP配置.png)

说明：

​	1、请求协议：HTTP

​	2、请求服务器IP：120.78.59.162

​	3、请求端口号：8080

​	4、请求方法：GET

​	5、请求URL：/newsInfo/list?currentPage=1&rows=10&condition=%7B%22searchContent%22%3A%22%22%7D

​	6、响应内容编码：UTF-8

### 3、超时配置

![](/images/集群压力测试/平均响应时间/超时配置.png)

说明：

​	客户端实现：Java

​	获取平均响应时间不进行超时限制。



### 4、聚合结果

- 开始时间：2019年5月8日12:59:14
- 结束时间：2019年5月8日13:03:15
- 聚合报告：

![](/images/集群压力测试/平均响应时间/聚合报告.png)

​	说明：

​		平均响应时间：232 ms，即 0.232 s

​		异常：0%

## 2、测试前

### 1、50线程

- JMeter配置

  - 测试理论

    根据[JMeter之Ramp-up Period（in seconds）说明](https://www.cnblogs.com/hjhsysu/p/9189897.html)可得以下参数：

    T：线程组启动时间

    n：线程组的线程数

    S：最后一个线程的启动时刻

    a：理论上达到并发访问效果所需的循环次数

    t：测试接口的平均响应时间

    R：单个线程运行时间

    

    由“获取平均响应时间测试”可知，t=0.232 s，因n=50，设T=50，则有：

    ​	S = (T- T/n) = (50-50/50) = 49

    ​	a*t > S => a > S/t，即  a > 49/0.232 = 212

    即循环次数至少为 212 次，才能让这 50 个线程并发访问测试接口，为了方便观测，就将循环次数设为1000次，由R = a*t=232，得：

    **并发时间段为：第49秒~第232秒。**

    

  - 线程组配置

  ![](/images/集群压力测试/50线程/线程组配置.png)

  说明：

  ​	1、线程数：50个

  ​	2、启动时间：50秒

  ​	3、循环次数：1000 次

  

  - HTTP配置

    - URL配置

    ![](/images/集群压力测试/50线程/HTTP配置.png)

    - URL数据

    ![](/images/集群压力测试/测试数据.png)

    - 超时配置

        ![](/images/集群压力测试/50线程/超时配置.png)

    ​      说明：

    ​	因服务器集群，需要通过Nginx进行反向代理，请求需要花费额外的时间，所以超时时间就设得大一些。

      		请求超时：60秒

      		响应超时：60秒

    ​		客户端实现：Java

- URL信息

  - 服务器1

  ![](/images/集群压力测试/50线程/测试前/服务器1/URL信息.png)

  说明：

  ​	1、请求次数：10

  ​	2、请求时间和：522

  ​	3、最大并发数：1

  

  - 服务器2

  ![](/images/集群压力测试/50线程/测试前/服务器2/URL信息.png)

  说明：

  ​	1、请求次数：10

  ​	2、请求时间和：3682

  ​	3、最大并发数：1

  

  - 服务器3

  ![](/images/集群压力测试/50线程/测试前/服务器3/URL信息.png)

  说明：

  ​	1、请求次数：10

  ​	2、请求时间和：4632

  ​	3、最大并发数：1

  - 小结

    因数据库和Redis主机都在服务器1（120.78.59.162）上，所以服务器1的请求耗时相对较短。

    - 服务器请求次数和：10+10+10=30 次
    - 服务器请求时间和：522+3682+4632=8863 毫秒
    - 服务器平均请求耗时：8863/30=294.53 毫秒/次

    

- 运行线程信息

  - 服务器1

  ![](/images/集群压力测试/50线程/测试前/服务器1/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：44

  

  - 服务器2

  ![](/images/集群压力测试/50线程/测试前/服务器2/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：44

  

  - 服务器3

  ![](/images/集群压力测试/50线程/测试前/服务器3/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：42

  ​			2、守护线程数：19

  ​			3、最大活跃线程数：44

  - 小结

    测试前三台服务器运行线程都差不多。

    

- CPU信息

  - 服务器1

  ![](/images/集群压力测试/50线程/测试前/服务器1/CPU信息.png)

  ​		说明：

  ​			1、PID：31361

  ​			2、当前CPU使用率：5%

  

  - 服务器2

  ![](/images/集群压力测试/50线程/测试前/服务器2/CPU信息.png)

  ​		说明：

  ​			1、PID：12558

  ​			2、当前CPU使用率：2%

  - 服务器3

  ![](/images/集群压力测试/50线程/测试前/服务器3/CPU信息.png)

  ​		说明：

  ​			1、PID：12557

  ​			2、当前CPU使用率：2%

  - 小结

    主机1（120.78.59.162）既要跑数据库，还要跑Nginx和SpringBootAdmin，所以主机1（120.78.59.162）的CPU使用要比其他两台主机要高些。

    

- 堆内存信息

  - 服务器1

    ![](/images/集群压力测试/50线程/测试前/服务器1/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 服务器2

    ![](/images/集群压力测试/50线程/测试前/服务器2/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 服务器3

    ![](/images/集群压力测试/50线程/测试前/服务器3/堆内存信息.png)

    - 堆内存使用：400MB以下
    - 非堆内存使用：150MB以下

    

  - 小结

    测试前各服务器的堆内存使用都差不多，都在服务器的承受范围之内。

    

- ECS服务器信息

  - 服务器1

  ![](/images/集群压力测试/50线程/测试前/服务器1/ECS信息.png)

  ​	说明：

  ​		1、CPU使用率： 50% 以下

  ​		2、网络带宽（入）： 5 MB/s 以下

  ​		3、网络带宽（出）： 5 MB/s 以下

  

  - 服务器2

  ![](/images/集群压力测试/50线程/测试前/服务器2/ECS信息.png)

  ​	说明：

  ​		1、CPU使用率： 50% 以下

  ​		2、网络带宽（入）： 3 MB/s 以下

  ​		3、网络带宽（出）： 3 MB/s  以下

  

  - 服务器3

  ![](/images/集群压力测试/50线程/测试前/服务器3/ECS信息.png)

  ​	说明：

  ​		1、CPU使用率： 50% 以下

  ​		2、网络带宽（入）： 3 MB/s 以下

  ​		3、网络带宽（出）： 3 MB/s  以下

  

  - 小结

    测试前各主机的CPU使用率和网络带宽使用不高，都在服务器的承受范围内。


### 2、100线程

- JMeter配置

  - 测试理论

    根据[JMeter之Ramp-up Period（in seconds）说明](https://www.cnblogs.com/hjhsysu/p/9189897.html)可得以下参数：

    T：线程组启动时间

    n：线程组的线程数

    S：最后一个线程的启动时刻

    a：理论上达到并发访问效果所需的循环次数

    t：测试接口的平均响应时间

    R：单个线程运行时间

    

    由“获取平均响应时间测试”可知，t=0.232 s，因n=100，设T=100，则有：

    ​	S = (T- T/n) = (100-100/100) = 99

    ​	a*t > S => a > S/t，即  a > 99/0.232 ≈ 427

    即循环次数至少为 427次，才能让这 100 个线程并发访问测试接口，为了方便观测，就将循环次数设为1000次，由R = a*t=232，得：

    **并发时间段为：第99秒~第232秒。**

    

  - 线程组配置

  ![](/images/集群压力测试/100线程/线程组配置.png)

  说明：

  ​	1、线程数：100 个

  ​	2、启动时间：100 秒

  ​	3、循环次数：1000 次

  

  - HTTP配置

    - URL配置

    ![](/images/集群压力测试/100线程/HTTP配置.png)

    - URL数据

    ![](/images/集群压力测试/测试数据.png)

    - 超时配置

        ![](/images/集群压力测试/100线程/超时配置.png)

    ​      说明：

    ​	因服务器集群，需要通过Nginx进行反向代理，请求需要花费额外的时间，所以超时时间就设得大一些。

      		请求超时：60秒

      		响应超时：60秒

- URL信息

  - 服务器1

  ![](/images/集群压力测试/100线程/测试前/服务器1/URL信息.png)

  说明：

  ​	1、请求次数：10

  ​	2、请求时间和：1004

  ​	3、最大并发数：1

  

  - 服务器2

  ![](/images/集群压力测试/100线程/测试前/服务器2/URL信息.png)

  说明：

  ​	1、请求次数：10

  ​	2、请求时间和：4047

  ​	3、最大并发数：1

  

  - 服务器3

  ![](/images/集群压力测试/100线程/测试前/服务器3/URL信息.png)

  说明：

  ​	1、请求次数：10

  ​	2、请求时间和：3859

  ​	3、最大并发数：1

  - 小结

    因数据库和Redis主机都在服务器1（120.78.59.162）上，所以服务器1的请求耗时相对较短。

    - 服务器请求次数和：10+10+10=30 次
    - 服务器请求时间和：1004+4047+3859=4757 毫秒
    - 服务器平均请求耗时：4757/30=297 毫秒/次

    

- 运行线程信息

  - 服务器1

  ![](/images/集群压力测试/100线程/测试前/服务器1/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：46

  

  - 服务器2

  ![](/images/集群压力测试/100线程/测试前/服务器2/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：46

  

  - 服务器3

  ![](/images/集群压力测试/100线程/测试前/服务器3/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：46

  - 小结

    三台服务器初始的运行线程都差不多。

    

- CPU信息

  - 服务器1

  ![](/images/集群压力测试/100线程/测试前/服务器1/CPU信息.png)

  ​		说明：

  ​			1、PID：13748

  ​			2、当前CPU使用率：4%

  

  - 服务器2

  ![](/images/集群压力测试/100线程/测试前/服务器2/CPU信息.png)

  ​		说明：

  ​			1、PID：13129

  ​			2、当前CPU使用率：3%

  - 服务器3

  ![](/images/集群压力测试/100线程/测试前/服务器3/CPU信息.png)

  ​		说明：

  ​			1、PID：13748

  ​			2、当前CPU使用率：2%

  - 小结

    主机1（120.78.59.162）既要跑数据库，还要跑Nginx和SpringBootAdmin，所以主机1（120.78.59.162）的CPU使用要比其他两台主机要高些。

    

- 堆内存信息

  - 服务器1

    ![](/images/集群压力测试/100线程/测试前/服务器1/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 服务器2

    ![](/images/集群压力测试/100线程/测试前/服务器2/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 服务器3

    ![](/images/集群压力测试/100线程/测试前/服务器3/堆内存信息.png)

    - 堆内存使用：400MB以下
    - 非堆内存使用：150MB以下

    

  - 小结

    测试前各服务器的堆内存使用都差不多，都在服务器的承受范围之内。

    

- ECS服务器信息

  - 服务器1

  ![](/images/集群压力测试/100线程/测试前/服务器1/ECS信息.png)

  ​	说明：

  ​		1、CPU使用率： 50% 以下

  ​		2、网络带宽（入）： 5 MB/S以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 服务器2

  ![](/images/集群压力测试/100线程/测试前/服务器2/ECS信息.png)

  ​	说明：

  ​		1、CPU使用率： 50% 以下

  ​		2、网络带宽（入）： 5 MB/s 以下

  ​		3、网络带宽（出）： 5 MB/s 以下

  

  - 服务器3

  ![](/images/集群压力测试/100线程/测试前/服务器3/ECS信息.png)

  ​	说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 小结

    测试前各主机的CPU使用率和网络带宽使用都不高。

### 3、150线程

- JMeter配置

  - 测试理论

    根据[JMeter之Ramp-up Period（in seconds）说明](https://www.cnblogs.com/hjhsysu/p/9189897.html)可得以下参数：

    T：线程组启动时间

    n：线程组的线程数

    S：最后一个线程的启动时刻

    a：理论上达到并发访问效果所需的循环次数

    t：测试接口的平均响应时间

    R：单个线程运行时间

    

    由“获取平均响应时间测试”可知，t=0.232 s，因n=20，设T=20，则有：

    ​	S = (T- T/n) = (150-150/150) = 149

    ​	a*t > S => a > S/t，即  a > 149/0.232 ≈ 643

    即循环次数至少为 643 次，才能让这 150 个线程并发访问测试接口，为了方便观测，就将循环次数设为1000次，由R = a*t=232，得：

    **并发时间段为：第149秒~第232秒。**

    

  - 线程组配置

  ![](/images/集群压力测试/150线程/线程组配置.png)

  说明：

  ​	1、线程数：150 个

  ​	2、启动时间：150 秒

  ​	3、循环次数：1000 次

  

  - HTTP配置

    - URL配置

    ![](/images/集群压力测试/150线程/HTTP配置.png)

    - URL数据

    ![](/images/集群压力测试/测试数据.png)

    - 超时配置

        ![](/images/集群压力测试/150线程/超时配置.png)

    ​      说明：

    ​	因服务器集群，需要通过Nginx进行反向代理，请求需要花费额外的时间，所以超时时间就设得大一些。

      		请求超时：60秒

      		响应超时：60秒

- URL信息

  - 服务器1

  ![](/images/集群压力测试/150线程/测试前/服务器1/URL信息.png)

  说明：

  ​	1、请求次数：10

  ​	2、请求时间和：1006

  ​	3、最大并发数：1

  

  - 服务器2

  ![](/images/集群压力测试/150线程/测试前/服务器2/URL信息.png)

  说明：

  ​	1、请求次数：10

  ​	2、请求时间和：3621

  ​	3、最大并发数：1

  

  - 服务器3

  ![](/images/集群压力测试/150线程/测试前/服务器3/URL信息.png)

  说明：

  ​	1、请求次数：10

  ​	2、请求时间和：4251

  ​	3、最大并发数：1

  - 小结

    因数据库和Redis主机都在服务器1（120.78.59.162）上，所以服务器1的请求耗时相对较短。

    - 服务器请求次数和：10+10+10=30 次
    - 服务器请求时间和：1006+3621+4251=8878毫秒
    - 服务器平均请求耗时：8878/30=295.93 毫秒/次

    

- 运行线程信息

  - 服务器1

  ![](/images/集群压力测试/150线程/测试前/服务器1/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：44

  

  - 服务器2

  ![](/images/集群压力测试/150线程/测试前/服务器2/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：44

  

  - 服务器3

  ![](/images/集群压力测试/150线程/测试前/服务器3/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：42

  ​			2、守护线程数：19

  ​			3、最大活跃线程数：44

  - 小结

    三台服务器初始的运行线程都差不多。

    

- CPU信息

  - 服务器1

  ![](/images/集群压力测试/150线程/测试前/服务器1/CPU信息.png)

  ​		说明：

  ​			1、PID：14146

  ​			2、当前CPU使用率：5%

  

  - 服务器2

  ![](/images/集群压力测试/150线程/测试前/服务器2/CPU信息.png)

  ​		说明：

  ​			1、PID：13525

  ​			2、当前CPU使用率：3%

  - 服务器3

  ![](/images/集群压力测试/150线程/测试前/服务器3/CPU信息.png)

  ​		说明：

  ​			1、PID：13525

  ​			2、当前CPU使用率：3%

  - 小结

    主机1（120.78.59.162）既要跑数据库，还要跑Nginx和SpringBootAdmin，所以主机1（120.78.59.162）的CPU使用要比其他两台主机要高些。

    

- 堆内存信息

  - 服务器1

    ![](/images/集群压力测试/150线程/测试前/服务器1/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 服务器2

    ![](/images/集群压力测试/150线程/测试前/服务器2/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 服务器3

    ![](/images/集群压力测试/150线程/测试前/服务器3/堆内存信息.png)

    - 堆内存使用：400MB以下
    - 非堆内存使用：150MB以下

    

  - 小结

    测试前各服务器的堆内存使用都差不多，都在服务器的承受范围之内。

    

- ECS服务器信息

  - 服务器1

  ![](/images/集群压力测试/150线程/测试前/服务器1/ECS信息.png)

  ​	说明：

  ​		1、CPU使用率： 50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 服务器2

  ![](/images/集群压力测试/150线程/测试前/服务器2/ECS信息.png)

  ​	说明：

  ​		1、CPU使用率： 50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 服务器3

  ![](/images/集群压力测试/150线程/测试前/服务器3/ECS信息.png)

  ​	说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 小结

    测试前各主机的CPU使用率和网络带宽使用都不高。

### 4、200线程

- JMeter配置

  - 测试理论

    根据[JMeter之Ramp-up Period（in seconds）说明](https://www.cnblogs.com/hjhsysu/p/9189897.html)可得以下参数：

    T：线程组启动时间

    n：线程组的线程数

    S：最后一个线程的启动时刻

    a：理论上达到并发访问效果所需的循环次数

    t：测试接口的平均响应时间

    R：单个线程运行时间

    

    由“获取平均响应时间测试”可知，t=0.232 s，因n=200，设T=200，则有：

    ​	S = (T- T/n) = (200-200/200) = 199

    ​	a*t > S => a > S/t，即  a > 199/0.232 ≈ 858

    即循环次数至少为 858 次，才能让这 200 个线程并发访问测试接口，为了方便观测，就将循环次数设为1000次，由R = a*t=232，得：

    **并发时间段为：第199秒~第232秒。**

    

  - 线程组配置

  ![](/images/集群压力测试/200线程/线程组配置.png)

  说明：

  ​	1、线程数：200 个

  ​	2、启动时间：200 秒

  ​	3、循环次数：1000 次

  

  - HTTP配置

    - URL配置

    ![](/images/集群压力测试/200线程/HTTP配置.png)

    - URL数据

    ![](/images/集群压力测试/测试数据.png)

    - 超时配置

        ![](/images/集群压力测试/200线程/超时配置.png)

    ​      说明：

    ​	因服务器集群，需要通过Nginx进行反向代理，请求需要花费额外的时间，所以超时时间就设得大一些。

      		请求超时：60 秒

      		响应超时：60 秒

- URL信息

  - 服务器1

  ![](/images/集群压力测试/200线程/测试前/服务器1/URL信息.png)

  说明：

  ​	1、请求次数：10

  ​	2、请求时间和：737

  ​	3、最大并发数：1

  

  - 服务器2

  ![](/images/集群压力测试/200线程/测试前/服务器2/URL信息.png)

  说明：

  ​	1、请求次数：10

  ​	2、请求时间和：3835

  ​	3、最大并发数：1

  

  - 服务器3

  ![](/images/集群压力测试/200线程/测试前/服务器3/URL信息.png)

  说明：

  ​	1、请求次数：10

  ​	2、请求时间和：4123

  ​	3、最大并发数：1

  

  - 小结

    因数据库和Redis主机都在服务器1（120.78.59.162）上，所以服务器1的请求耗时相对较短。

    - 服务器请求次数和：10+10+10=30 次
    - 服务器请求时间和：737+3835+4123=9329毫秒
    - 服务器平均请求耗时：4757/30=310.97 毫秒/次

    

- 运行线程信息

  - 服务器1

  ![](/images/集群压力测试/200线程/测试前/服务器1/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：46

  

  - 服务器2

  ![](/images/集群压力测试/200线程/测试前/服务器2/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：42

  ​			2、守护线程数：19

  ​			3、最大活跃线程数：46

  

  - 服务器3

  ![](/images/集群压力测试/200线程/测试前/服务器3/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：46

  - 小结

    三台服务器初始的运行线程都差不多。

    

- CPU信息

  - 服务器1

  ![](/images/集群压力测试/200线程/测试前/服务器1/CPU信息.png)

  ​		说明：

  ​			1、PID：14483

  ​			2、当前CPU使用率：5%

  

  - 服务器2

  ![](/images/集群压力测试/200线程/测试前/服务器2/CPU信息.png)

  ​		说明：

  ​			1、PID：13843

  ​			2、当前CPU使用率：2%

  - 服务器3

  ![](/images/集群压力测试/200线程/测试前/服务器3/CPU信息.png)

  ​		说明：

  ​			1、PID：14483

  ​			2、当前CPU使用率：4%

  - 小结

    主机1（120.78.59.162）既要跑数据库，还要跑Nginx和SpringBootAdmin，所以主机1（120.78.59.162）的CPU使用要比其他两台主机要高些。

    

- 堆内存信息

  - 服务器1

    ![](/images/集群压力测试/200线程/测试前/服务器1/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 服务器2

    ![](/images/集群压力测试/200线程/测试前/服务器2/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 服务器3

    ![](/images/集群压力测试/200线程/测试前/服务器3/堆内存信息.png)

    - 堆内存使用：400MB以下
    - 非堆内存使用：150MB以下

    

  - 小结

    测试前各服务器的堆内存使用都差不多，都在服务器的承受范围之内。

    

- ECS服务器信息

  - 服务器1

  ![](/images/集群压力测试/200线程/测试前/服务器1/ECS信息.png)

  ​	说明：

  ​		1、CPU使用率： 50% 一下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 服务器2

  ![](/images/集群压力测试/200线程/测试前/服务器2/ECS信息.png)

  ​	说明：

  ​		1、CPU使用率： 50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）：5 MB/S 以下

  

  - 服务器3

  ![](/images/集群压力测试/200线程/测试前/服务器3/ECS信息.png)

  ​	说明：

  ​		1、CPU使用率：50%  以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 小结

    测试前各主机的CPU使用率和网络带宽使用都不高。


### 5、300线程

- JMeter配置

  - 测试理论

    根据[JMeter之Ramp-up Period（in seconds）说明](https://www.cnblogs.com/hjhsysu/p/9189897.html)可得以下参数：

    T：线程组启动时间

    n：线程组的线程数

    S：最后一个线程的启动时刻

    a：理论上达到并发访问效果所需的循环次数

    t：测试接口的平均响应时间

    R：单个线程运行时间

    

    由“获取平均响应时间测试”可知，t=0.232 s，因n=300，设T=300，则有：

    ​	S = (T- T/n) = (300-300/300) = 299

    ​	a*t > S => a > S/t，即  a > 299/0.232 ≈ 1289

    即循环次数至少为 1289次，才能让这 300 个线程并发访问测试接口，为了方便观测，就将循环次数设为2000次，由R = a*t=464，得：

    **并发时间段为：第299秒~第464秒。**

    

  - 线程组配置

  ![](/images/集群压力测试/300线程/线程组配置.png)

  说明：

  ​	1、线程数：300 个

  ​	2、启动时间：300 秒

  ​	3、循环次数：2000 次

  

  - HTTP配置

    - URL配置

    ![](/images/集群压力测试/300线程/HTTP配置.png)

    - URL数据

    ![](/images/集群压力测试/测试数据.png)

    - 超时配置

        ![](/images/集群压力测试/300线程/超时配置.png)

    ​      说明：

    ​	因服务器集群，需要通过Nginx进行反向代理，请求需要花费额外的时间，所以超时时间就设得大一些。

      		请求超时：60 秒

      		响应超时：60 秒

- URL信息

  - 服务器1

  ![](/images/集群压力测试/300线程/测试前/服务器1/URL信息.png)

  说明：

  ​	1、请求次数：10

  ​	2、请求时间和：750

  ​	3、最大并发数：1

  

  - 服务器2

  ![](/images/集群压力测试/300线程/测试前/服务器2/URL信息.png)

  说明：

  ​	1、请求次数：10

  ​	2、请求时间和：4598

  ​	3、最大并发数：1

  

  - 服务器3

  ![](/images/集群压力测试/300线程/测试前/服务器3/URL信息.png)

  说明：

  ​	1、请求次数：10

  ​	2、请求时间和：4397

  ​	3、最大并发数：1

  - 小结

    因数据库和Redis主机都在服务器1（120.78.59.162）上，所以服务器1的请求耗时相对较短。

    - 服务器请求次数和：10+10+10=30 次
    - 服务器请求时间和：750+4598+4397=9745 毫秒
    - 服务器平均请求耗时：9745/30=324.83毫秒/次

    

- 运行线程信息

  - 服务器1

  ![](/images/集群压力测试/300线程/测试前/服务器1/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：44

  

  - 服务器2

  ![](/images/集群压力测试/300线程/测试前/服务器2/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：42

  ​			2、守护线程数：19

  ​			3、最大活跃线程数：44

  

  - 服务器3

  ![](/images/集群压力测试/300线程/测试前/服务器3/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：44

  - 小结

    三台服务器初始的运行线程都差不多。

    

- CPU信息

  - 服务器1

  ![](/images/集群压力测试/300线程/测试前/服务器1/CPU信息.png)

  ​		说明：

  ​			1、PID：14921

  ​			2、当前CPU使用率：4%

  

  - 服务器2

  ![](/images/集群压力测试/300线程/测试前/服务器2/CPU信息.png)

  ​		说明：

  ​			1、PID：14281

  ​			2、当前CPU使用率：3%

  - 服务器3

  ![](/images/集群压力测试/300线程/测试前/服务器3/CPU信息.png)

  ​		说明：

  ​			1、PID：14921

  ​			2、当前CPU使用率：4%

  - 小结

    主机1（120.78.59.162）既要跑数据库，还要跑Nginx和SpringBootAdmin，所以主机1（120.78.59.162）的CPU使用要比其他两台主机要高些。

    

- 堆内存信息

  - 服务器1

    ![](/images/集群压力测试/300线程/测试前/服务器1/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 服务器2

    ![](/images/集群压力测试/300线程/测试前/服务器2/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 服务器3

    ![](/images/集群压力测试/300线程/测试前/服务器3/堆内存信息.png)

    - 堆内存使用：400MB以下
    - 非堆内存使用：150MB以下

    

  - 小结

    测试前各服务器的堆内存使用都差不多，都在服务器的承受范围之内。

    

- ECS服务器信息

  - 服务器1

  ![](/images/集群压力测试/300线程/测试前/服务器1/ECS信息.png)

  ​	说明：

  ​		1、CPU使用率： 50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 服务器2

  ![](/images/集群压力测试/300线程/测试前/服务器2/ECS信息.png)

  ​	说明：

  ​		1、CPU使用率： 50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 服务器3

  ![](/images/集群压力测试/300线程/测试前/服务器3/ECS信息.png)

  ​	说明：

  ​		1、CPU使用率： 50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 小结

    测试前各主机的CPU使用率和网络带宽使用都不高。

## 2、测试时

### 1、50线程

- 时间

  - 开始时间：2019年5月8日13:18:41

  - 并发时间段：**第49秒~第232秒。**

  - 记录时间：2019年5月8日13:19:45

  - 结束时间：2019年5月8日13:25:02

    

- URL信息

  - 服务器1

  ![](/images/集群压力测试/50线程/测试时/服务器1/URL信息.png)

  说明：

  ​	1、请求次数：1583

  ​	2、请求时间和：20543

  ​	3、最大并发数：3

  

  - 服务器2

  ![](/images/集群压力测试/50线程/测试时/服务器2/URL信息.png)

  说明：

  ​	1、请求次数：3744

  ​	2、请求时间和：857329

  ​	3、最大并发数：16

  

  - 服务器3

  ![](/images/集群压力测试/50线程/测试时/服务器3/URL信息.png)

  说明：

  ​	1、请求次数：4691

  ​	2、请求时间和：1245145

  ​	3、最大并发数：16

  

  - 小结

    经过测试可知，服务器2和服务器3承受的请求次数比服务器1要高得多，且是服务器1的2倍左右，服务器2和服务器3的最大并发也比服务器1要高得多，由此可知 Nginx 的负载均衡配置生效，且运行正常。

    

- 运行线程信息

  - 服务器1

  ![](/images/集群压力测试/50线程/测试时/服务器1/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：44

  

  - 服务器2

  ![](/images/集群压力测试/50线程/测试时/服务器2/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：44

  

  - 服务器3

  ![](/images/集群压力测试/50线程/测试时/服务器3/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：42

  ​			2、守护线程数：19

  ​			3、最大活跃线程数：44

  - 小结

    请求被Nginx负载均衡分散到三个服务器中进行处理，所以理论并发时间段内，并未看到三台服务器的运行线程数据有明显变化。

    

- CPU信息

  - 服务器1

  ![](/images/集群压力测试/50线程/测试时/服务器1/CPU信息.png)

  ​		说明：

  ​			1、PID：13161

  ​			2、当前CPU使用率：21%

  

  - 服务器2

  ![](/images/集群压力测试/50线程/测试时/服务器2/CPU信息.png)

  ​		说明：

  ​			1、PID：12558

  ​			2、当前CPU使用率：14%

  - 服务器3

  ![](/images/集群压力测试/50线程/测试时/服务器3/CPU信息.png)

  ​		说明：

  ​			1、PID：12557

  ​			2、当前CPU使用率：13%

  - 小结

    测试过程中，各服务器的CPU使用率都有提高，但都在服务器的承受范围之内。

    

- 堆内存信息

  - 服务器1

    ![](/images/集群压力测试/50线程/测试时/服务器1/堆内存信息.png)

    - 堆内存使用：400 MB以下
    - 非堆内存使用：150 MB以下

    

  - 服务器2

    ![](/images/集群压力测试/50线程/测试时/服务器2/堆内存信息.png)

    - 堆内存使用：400 MB以下

    - 非堆内存使用：150 MB以下

      

  - 服务器3

    ![](/images/集群压力测试/50线程/测试时/服务器3/堆内存信息.png)

    - 堆内存使用：400 MB以下
    - 非堆内存使用：150 MB以下

  - 小结

    测试过程中，各服务器的堆内存使用虽有变化，但都在最大堆内存之内，没有内存溢出。

    

- ECS服务器信息

  - 服务器1

  ![](/images/集群压力测试/50线程/测试时/服务器1/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 10 MB/S 以下

  ​		3、网络带宽（出）： 15 MB/S 以下

  

  - 服务器2

  ![](/images/集群压力测试/50线程/测试时/服务器2/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 服务器3

  ![](/images/集群压力测试/50线程/测试时/服务器3/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 小结

  三台服务器的CPU使用率都在50%以下，而网络带宽方面，因Nginx运行在服务器1，所以服务器1的带宽使用较高，但也都在服务器的承受范围之内。



### 2、100线程

- 时间

  - 开始时间：2019年5月8日14:11:02

  - 并发时间段：**第99秒~第232秒。**

  - 记录时间：2019年5月8日14:13:12

  - 结束时间：2019年5月8日14:22:27

    

- URL信息

  - 服务器1

  ![](/images/集群压力测试/100线程/测试时/服务器1/URL信息.png)

  说明：

  ​	1、请求次数：3408

  ​	2、请求时间和：41425

  ​	3、最大并发数：3

  

  - 服务器2

  ![](/images/集群压力测试/100线程/测试时/服务器2/URL信息.png)

  说明：

  ​	1、请求次数：10419

  ​	2、请求时间和：2535027

  ​	3、最大并发数：16

  

  - 服务器3

  ![](/images/集群压力测试/100线程/测试时/服务器3/URL信息.png)

  说明：

  ​	1、请求次数：11095

  ​	2、请求时间和：2866328

  ​	3、最大并发数：16

  

  - 小结

    经过测试可知，服务器2和服务器3承受的请求次数比服务器1要高得多，且是服务器1的2倍左右，服务器2和服务器3的最大并发也比服务器1要高得多，由此可知 Nginx 的负载均衡配置生效，且运行正常。

    

- 运行线程信息

  - 服务器1

  ![](/images/集群压力测试/100线程/测试时/服务器1/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：46

  

  - 服务器2

  ![](/images/集群压力测试/100线程/测试时/服务器2/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：46

  

  - 服务器3

  ![](/images/集群压力测试/100线程/测试时/服务器3/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：46

  - 小结

    请求被Nginx负载均衡分散到三个服务器中进行处理，所以理论并发时间段内，并未看到三台服务器的运行线程数据有明显变化。

    

- CPU信息

  - 服务器1

  ![](/images/集群压力测试/100线程/测试时/服务器1/CPU信息.png)

  ​		说明：

  ​			1、PID：13748

  ​			2、当前CPU使用率：21%

  

  - 服务器2

  ![](/images/集群压力测试/100线程/测试时/服务器2/CPU信息.png)

  ​		说明：

  ​			1、PID：13129

  ​			2、当前CPU使用率：16%

  - 服务器3

  ![](/images/集群压力测试/100线程/测试时/服务器3/CPU信息.png)

  ​		说明：

  ​			1、PID：13748

  ​			2、当前CPU使用率：21%

  - 小结

    测试过程中，各服务器的CPU使用率都有提高，但都在服务器的承受范围之内。

    

- 堆内存信息

  - 服务器1

    ![](/images/集群压力测试/100线程/测试时/服务器1/堆内存信息.png)

    - 堆内存使用：400MB以下
    - 非堆内存使用：150MB以下

    

  - 服务器2

    ![](/images/集群压力测试/100线程/测试时/服务器2/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 服务器3

    ![](/images/集群压力测试/100线程/测试时/服务器3/堆内存信息.png)

    - 堆内存使用：400MB以下
    - 非堆内存使用：150MB以下

  - 小结

    测试过程中，各服务器的堆内存使用虽有变化，但都在最大堆内存之内，没有内存溢出。

    

- ECS服务器信息

  - 服务器1

  ![](/images/集群压力测试/100线程/测试时/服务器1/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 10 MB/S以下

  ​		3、网络带宽（出）： 15 MB/S以下

  

  - 服务器2

  ![](/images/集群压力测试/100线程/测试时/服务器2/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 5 MB/S以下

  ​		3、网络带宽（出）： 5 MB/S以下

  

  - 服务器3

  ![](/images/集群压力测试/100线程/测试时/服务器3/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 5 MB/S以下

  ​		3、网络带宽（出）： 5 MB/S以下

  

  - 小结

  三台服务器的CPU使用率都在50%以下，而网络带宽方面，因Nginx运行在服务器1，所以服务器1的带宽使用较高，但也都在服务器的承受范围之内。



### 3、150线程

- 时间

  - 开始时间：2019年5月8日14:33:25

  - 并发时间段：**第149秒~第232秒。**

  - 记录时间：2019年5月8日14:36:14

  - 结束时间：2019年5月8日14:49:52

    

- URL信息

  - 服务器1

  ![](/images/集群压力测试/150线程/测试时/服务器1/URL信息.png)

  说明：

  ​	1、请求次数：4760

  ​	2、请求时间和：52777

  ​	3、最大并发数：4

  

  - 服务器2

  ![](/images/集群压力测试/150线程/测试时/服务器2/URL信息.png)

  说明：

  ​	1、请求次数：10089

  ​	2、请求时间和：2278029

  ​	3、最大并发数：16

  

  - 服务器3

  ![](/images/集群压力测试/150线程/测试时/服务器3/URL信息.png)

  说明：

  ​	1、请求次数：10574

  ​	2、请求时间和：2687901

  ​	3、最大并发数：16

  

  - 小结

    经过测试可知，服务器2和服务器3承受的请求次数比服务器1要高得多，且是服务器1的2倍左右，服务器2和服务器3的最大并发也比服务器1要高得多，由此可知 Nginx 的负载均衡配置生效，且运行正常。

    

- 运行线程信息

  - 服务器1

  ![](/images/集群压力测试/150线程/测试时/服务器1/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：42

  ​			2、守护线程数：19

  ​			3、最大活跃线程数：46

  

  - 服务器2

  ![](/images/集群压力测试/150线程/测试时/服务器2/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：46

  

  - 服务器3

  ![](/images/集群压力测试/150线程/测试时/服务器3/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：42

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：46

  - 小结

    请求被Nginx负载均衡分散到三个服务器中进行处理，所以理论并发时间段内，并未看到三台服务器的运行线程数据有明显变化。

    

- CPU信息

  - 服务器1

  ![](/images/集群压力测试/150线程/测试时/服务器1/CPU信息.png)

  ​		说明：

  ​			1、PID：14146

  ​			2、当前CPU使用率：18%

  

  - 服务器2

  ![](/images/集群压力测试/150线程/测试时/服务器2/CPU信息.png)

  ​		说明：

  ​			1、PID：13525

  ​			2、当前CPU使用率：26%

  - 服务器3

  ![](/images/集群压力测试/150线程/测试时/服务器3/CPU信息.png)

  ​		说明：

  ​			1、PID：13525

  ​			2、当前CPU使用率：13%

  - 小结

    测试过程中，各服务器的CPU使用率都有提高，但都在服务器的承受范围之内。

    

- 堆内存信息

  - 服务器1

    ![](/images/集群压力测试/150线程/测试时/服务器1/堆内存信息.png)

    - 堆内存使用：400MB以下
    - 非堆内存使用：150MB以下

    

  - 服务器2

    ![](/images/集群压力测试/150线程/测试时/服务器2/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 服务器3

    ![](/images/集群压力测试/150线程/测试时/服务器3/堆内存信息.png)

    - 堆内存使用：400MB以下
    - 非堆内存使用：150MB以下

      

  - 小结

    测试过程中，各服务器的堆内存使用虽有变化，但都在最大堆内存之内，没有内存溢出。

    

- ECS服务器信息

  - 服务器1

  ![](/images/集群压力测试/150线程/测试时/服务器1/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 10 MB/S 以下

  ​		3、网络带宽（出）： 15 MB/S 以下

  

  - 服务器2

  ![](/images/集群压力测试/150线程/测试时/服务器2/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 服务器3

  ![](/images/集群压力测试/150线程/测试时/服务器3/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 小结

  三台服务器的CPU使用率都在50%以下，而网络带宽方面，因Nginx运行在服务器1，所以服务器1的带宽使用较高，但也都在服务器的承受范围之内。



### 4、200线程

- 时间

  - 开始时间：2019年5月8日15:02:17

  - 并发时间段：**第199秒~第232秒。**

  - 记录时间：2019年5月8日15:05:40

  - 结束时间：2019年5月8日15:24:41

    

- URL信息

  - 服务器1

  ![](/images/集群压力测试/200线程/测试时/服务器1/URL信息.png)

  说明：

  ​	1、请求次数：5874

  ​	2、请求时间和：63539

  ​	3、最大并发数：4

  

  - 服务器2

  ![](/images/集群压力测试/200线程/测试时/服务器2/URL信息.png)

  说明：

  ​	1、请求次数：12351

  ​	2、请求时间和：2819758

  ​	3、最大并发数：16

  

  - 服务器3

  ![](/images/集群压力测试/200线程/测试时/服务器3/URL信息.png)

  说明：

  ​	1、请求次数：12660

  ​	2、请求时间和：3292878

  ​	3、最大并发数：16

  

  - 小结

    经过测试可知，服务器2和服务器3承受的请求次数比服务器1要高得多，且是服务器1的2倍左右，服务器2和服务器3的最大并发也比服务器1要高得多，由此可知 Nginx 的负载均衡配置生效，且运行正常。

    

- 运行线程信息

  - 服务器1

  ![](/images/集群压力测试/200线程/测试时/服务器1/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：46

  

  - 服务器2

  ![](/images/集群压力测试/200线程/测试时/服务器2/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：46

  

  - 服务器3

  ![](/images/集群压力测试/200线程/测试时/服务器3/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：46

  - 小结

    请求被Nginx负载均衡分散到三个服务器中进行处理，所以理论并发时间段内，并未看到三台服务器的运行线程数据有明显变化。

    

- CPU信息

  - 服务器1

  ![](/images/集群压力测试/200线程/测试时/服务器1/CPU信息.png)

  ​		说明：

  ​			1、PID：14483

  ​			2、当前CPU使用率：20%

  

  - 服务器2

  ![](/images/集群压力测试/200线程/测试时/服务器2/CPU信息.png)

  ​		说明：

  ​			1、PID：13843

  ​			2、当前CPU使用率：16%

  - 服务器3

  ![](/images/集群压力测试/200线程/测试时/服务器3/CPU信息.png)

  ​		说明：

  ​			1、PID：14483

  ​			2、当前CPU使用率：19%

  - 小结

    测试过程中，各服务器的CPU使用率都有提高，但都在服务器的承受范围之内。

    

- 堆内存信息

  - 服务器1

    ![](/images/集群压力测试/200线程/测试时/服务器1/堆内存信息.png)

    - 堆内存使用：400MB以下
    - 非堆内存使用：150MB以下

    

  - 服务器2

    ![](/images/集群压力测试/200线程/测试时/服务器2/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 服务器3

    ![](/images/集群压力测试/200线程/测试时/服务器3/堆内存信息.png)

    - 堆内存使用：400MB以下
    - 非堆内存使用：150MB以下

  - 小结

    测试过程中，各服务器的堆内存使用虽有变化，但都在最大堆内存之内，没有内存溢出。

    

- ECS服务器信息

  - 服务器1

  ![](/images/集群压力测试/200线程/测试时/服务器1/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 10 MB/S 以下

  ​		3、网络带宽（出）： 15 MB/S 以下

  

  - 服务器2

  ![](/images/集群压力测试/200线程/测试时/服务器2/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 服务器3

  ![](/images/集群压力测试/200线程/测试时/服务器3/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 小结

  三台服务器的CPU使用率都在50%以下，而网络带宽方面，因Nginx运行在服务器1，所以服务器1的带宽使用较高，但也都在服务器的承受范围之内。


### 5、300线程

- 时间

  - 开始时间：2019年5月8日15:45:37

  - 并发时间段：**第299秒~第464秒。**

  - 记录时间：2019年5月8日15:50:43

  - 结束时间：2019年5月8日16:49:57

    

- URL信息

  - 服务器1

  ![](/images/集群压力测试/300线程/测试时/服务器1/URL信息.png)

  说明：

  ​	1、请求次数：9100

  ​	2、请求时间和：98093

  ​	3、最大并发数：4

  

  - 服务器2

  ![](/images/集群压力测试/300线程/测试时/服务器2/URL信息.png)

  说明：

  ​	1、请求次数：20509

  ​	2、请求时间和：5190275

  ​	3、最大并发数：16

  

  - 服务器3

  ![](/images/集群压力测试/300线程/测试时/服务器3/URL信息.png)

  说明：

  ​	1、请求次数：19382

  ​	2、请求时间和：4375322

  ​	3、最大并发数：16

  

  - 小结

    经过测试可知，服务器2和服务器3承受的请求次数比服务器1要高得多，且是服务器1的2倍左右，服务器2和服务器3的最大并发也比服务器1要高得多，由此可知 Nginx 的负载均衡配置生效，且运行正常。

    

- 运行线程信息

  - 服务器1

  ![](/images/集群压力测试/300线程/测试时/服务器1/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：42

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：44

  

  - 服务器2

  ![](/images/集群压力测试/300线程/测试时/服务器2/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：44

  

  - 服务器3

  ![](/images/集群压力测试/300线程/测试时/服务器3/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：44

  - 小结

    请求被Nginx负载均衡分散到三个服务器中进行处理，所以理论并发时间段内，并未看到三台服务器的运行线程数据有明显变化。

    

- CPU信息

  - 服务器1

  ![](/images/集群压力测试/300线程/测试时/服务器1/CPU信息.png)

  ​		说明：

  ​			1、PID：14921

  ​			2、当前CPU使用率：17%

  

  - 服务器2

  ![](/images/集群压力测试/300线程/测试时/服务器2/CPU信息.png)

  ​		说明：

  ​			1、PID：14281

  ​			2、当前CPU使用率：12%

  - 服务器3

  ![](/images/集群压力测试/300线程/测试时/服务器2/CPU信息.png)

  ​		说明：

  ​			1、PID：14281

  ​			2、当前CPU使用率：12%

  - 小结

    测试过程中，各服务器的CPU使用率都有提高，但都在服务器的承受范围之内。

    

- 堆内存信息

  - 服务器1

    ![](/images/集群压力测试/300线程/测试时/服务器1/堆内存信息.png)

    - 堆内存使用：400MB以下
    - 非堆内存使用：150MB以下

    

  - 服务器2

    ![](/images/集群压力测试/300线程/测试时/服务器2/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 服务器3

    ![](/images/集群压力测试/300线程/测试时/服务器3/堆内存信息.png)

    - 堆内存使用：400MB以下
    - 非堆内存使用：150MB以下

      

  - 小结

    测试过程中，各服务器的堆内存使用虽有变化，但都在最大堆内存之内，没有内存溢出。

    

- ECS服务器信息

  - 服务器1

  ![](/images/集群压力测试/300线程/测试时/服务器1/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 10 MB/S 以下

  ​		3、网络带宽（出）： 15 MB/S 以下

  

  - 服务器2

  ![](/images/集群压力测试/300线程/测试时/服务器2/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 服务器3

  ![](/images/集群压力测试/300线程/测试时/服务器3/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 小结

  三台服务器的CPU使用率都在50%以下，而网络带宽方面，因Nginx运行在服务器1，所以服务器1的带宽使用较高，但也都在服务器的承受范围之内。

## 3、测试后

### 1、50线程

- URL信息

  - 服务器1

  ![](/images/集群压力测试/50线程/测试后/服务器1/URL信息.png)

  说明：

  ​	1、请求次数：10010

  ​	2、请求时间和：105779

  ​	3、最大并发数：5

  

  - 服务器2

  ![](/images/集群压力测试/50线程/测试后/服务器2/URL信息.png)

  说明：

  ​	1、请求次数：20010

  ​	2、请求时间和：4564153

  ​	3、最大并发数：16

  

  - 服务器3

  ![](/images/集群压力测试/50线程/测试后/服务器3/URL信息.png)

  说明：

  ​	1、请求次数：20010

  ​	2、请求时间和：5343451

  ​	3、最大并发数：16

  

  - 小结

    1、请求次数和：50030

    2、请求时间和：10013383

    3、单服务器最高并发：16

    4、平均请求耗时：10013383/50030=200.15 毫秒

    

- 运行线程信息

  - 服务器1

  ![](/images/集群压力测试/50线程/测试后/服务器1/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：42

  ​			2、守护线程数：19

  ​			3、最大活跃线程数：46

  

  - 服务器2

  ![](/images/集群压力测试/50线程/测试后/服务器2/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：42

  ​			2、守护线程数：19

  ​			3、最大活跃线程数：46

  

  - 服务器3

  ![](/images/集群压力测试/50线程/测试后/服务器3/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：42

  ​			2、守护线程数：19

  ​			3、最大活跃线程数：46

  

  - 小结

    各服务器运行线程数据基本一致，且都不高，说明负载均衡效果良好。

    

- CPU信息

  - 服务器1

  ![](/images/集群压力测试/50线程/测试后/服务器1/CPU信息.png)

  ​		说明：

  ​			1、PID：13161

  ​			2、当前CPU使用率：4%

  - 服务器2

  ![](/images/集群压力测试/50线程/测试后/服务器2/CPU信息.png)

  ​		说明：

  ​			1、PID：12558

  ​			2、当前CPU使用率：3%

  - 服务器3

  ![](/images/集群压力测试/50线程/测试后/服务器3/CPU信息.png)

  ​		说明：

  ​			1、PID：12557

  ​			2、当前CPU使用率：2%

  - 小结

    测试完成后，各服务器CPU使用率都降下来了。

    

- 堆内存使用

  - 服务器1

    ![](/images/集群压力测试/50线程/测试后/服务器1/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 服务器2

    ![](/images/集群压力测试/50线程/测试后/服务器2/堆内存信息.png)

    - 堆内存使用：400MB以下
    - 非堆内存使用：150MB以下

    

  - 服务器3

    ![](/images/集群压力测试/50线程/测试后/服务器3/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 小结

    测试过程中，堆内存使用虽有变化，但还算稳定，且整体内存占用都不高。

    

- ECS服务器信息

  - 服务器1

  ![](/images/集群压力测试/50线程/测试后/服务器1/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 10 MB/S 以下

  ​		3、网络带宽（出）： 15 MB/S以下

  

  - 服务器2

  ![](/images/集群压力测试/50线程/测试后/服务器2/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S以下

  

  - 服务器3

  ![](/images/集群压力测试/50线程/测试后/服务器3/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S以下

  

  - 小结

    ​	测试过程中，三台服务器的CPU使用率都在50%以下，而网络带宽方面，因Nginx运行在服务器1，所以服务器1的带宽使用较高，但也都在服务器的承受范围之内。

    

- JMeter测试结果

![](/images/集群压力测试/50线程/聚合报告.png)

说明：

​	1、样本数：5万

​	2、平均响应时间：328 毫秒

​	3、吞吐量：131.5次/秒

​	4、请求异常：0%



### 2、100线程

- URL信息

  - 服务器1

  ![](/images/集群压力测试/100线程/测试后/服务器1/URL信息.png)

  说明：

  ​	1、请求次数：20010

  ​	2、请求时间和：188588

  ​	3、最大并发数：4

  

  - 服务器2

  ![](/images/集群压力测试/100线程/测试后/服务器2/URL信息.png)

  说明：

  ​	1、请求次数：40009

  ​	2、请求时间和：9636724

  ​	3、最大并发数：16

  

  - 服务器3

  ![](/images/集群压力测试/100线程/测试后/服务器3/URL信息.png)

  说明：

  ​	1、请求次数：40011

  ​	2、请求时间和：10294506

  ​	3、最大并发数：16

  

  - 小结

    1、请求次数和：100030

    2、请求时间和：20119818

    3、单服务器最高并发：16

    4、平均请求耗时：20119818/100030=201.14 毫秒

    

- 运行线程信息

  - 服务器1

  ![](/images/集群压力测试/100线程/测试后/服务器1/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：46

  

  - 服务器2

  ![](/images/集群压力测试/100线程/测试后/服务器2/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：42

  ​			2、守护线程数：19

  ​			3、最大活跃线程数：46

  

  - 服务器3

  ![](/images/集群压力测试/100线程/测试后/服务器3/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：46

  

  - 小结

    各服务器运行线程数据基本一致，且都不高，服务器的负载均衡效果良好。

    

- CPU信息

  - 服务器1

  ![](/images/集群压力测试/100线程/测试后/服务器1/CPU信息.png)

  ​		说明：

  ​			1、PID：13748

  ​			2、当前CPU使用率：4%

  - 服务器2

  ![](/images/集群压力测试/100线程/测试后/服务器2/CPU信息.png)

  ​		说明：

  ​			1、PID：13129

  ​			2、当前CPU使用率：2%

  - 服务器3

  ![](/images/集群压力测试/100线程/测试后/服务器3/CPU信息.png)

  ​		说明：

  ​			1、PID：13748

  ​			2、当前CPU使用率：2%

  - 小结

    测试完成后，各服务器CPU使用率都降下来了。

    

- 堆内存使用

  - 服务器1

    ![](/images/集群压力测试/100线程/测试后/服务器1/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 服务器2

    ![](/images/集群压力测试/100线程/测试后/服务器2/堆内存信息.png)

    - 堆内存使用：400MB以下
    - 非堆内存使用：150MB以下

    

  - 服务器3

    ![](/images/集群压力测试/100线程/测试后/服务器3/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 小结

    测试过程中，堆内存使用虽有变化，但还算稳定，且整体内存占用都不高。

    

- ECS服务器信息

  - 服务器1

  ![](/images/集群压力测试/100线程/测试后/服务器1/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 10 MB/S 以下

  ​		3、网络带宽（出）： 15 MB/S以下

  

  - 服务器2

  ![](/images/集群压力测试/100线程/测试后/服务器2/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S以下

  

  - 服务器3

  ![](/images/集群压力测试/100线程/测试后/服务器3/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S以下

  

  - 小结

    ​	测试过程中，三台服务器的CPU使用率都在50%以下，而网络带宽方面，因Nginx运行在服务器1，所以服务器1的带宽使用较高，但也都在服务器的承受范围之内。

    

- JMeter测试结果

![](/images/集群压力测试/100线程/聚合报告.png)

说明：

​	1、样本数：10万

​	2、平均响应时间：590 毫秒

​	3、吞吐量：146.1 次/秒

​	4、请求异常：0



### 3、150线程

- URL信息

  - 服务器1

  ![](/images/集群压力测试/150线程/测试后/服务器1/URL信息.png)

  说明：

  ​	1、请求次数：30010

  ​	2、请求时间和：246932

  ​	3、最大并发数：5

  

  - 服务器2

  ![](/images/集群压力测试/150线程/测试后/服务器2/URL信息.png)

  说明：

  ​	1、请求次数：60010

  ​	2、请求时间和：13362558

  ​	3、最大并发数：16

  

  - 服务器3

  ![](/images/集群压力测试/150线程/测试后/服务器3/URL信息.png)

  说明：

  ​	1、请求次数：60010

  ​	2、请求时间和：15136917

  ​	3、最大并发数：16

  

  - 小结

    1、请求次数和：150030

    2、请求时间和：2876407

    3、单服务器最高并发：16

    4、平均请求耗时：2876407/150030= 191.60 毫秒

    

- 运行线程信息

  - 服务器1

  ![](/images/集群压力测试/150线程/测试后/服务器1/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：42

  ​			2、守护线程数：19

  ​			3、最大活跃线程数：46

  

  - 服务器2

  ![](/images/集群压力测试/150线程/测试后/服务器2/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：46

  

  - 服务器3

  ![](/images/集群压力测试/150线程/测试后/服务器2/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：46

  

  - 小结

    各服务器运行线程数据基本一致，且都不高，服务器的负载均衡效果良好。

    

- CPU信息

  - 服务器1

  ![](/images/集群压力测试/150线程/测试后/服务器1/CPU信息.png)

  ​		说明：

  ​			1、PID：14146

  ​			2、当前CPU使用率：12%

  - 服务器2

  ![](/images/集群压力测试/150线程/测试后/服务器2/CPU信息.png)

  ​		说明：

  ​			1、PID：13525

  ​			2、当前CPU使用率：1%

  - 服务器3

  ![](/images/集群压力测试/150线程/测试后/服务器3/CPU信息.png)

  ​		说明：

  ​			1、PID：13525

  ​			2、当前CPU使用率：3%

  - 小结

    测试完成后，各服务器CPU使用率都降下来了。

    

- 堆内存使用

  - 服务器1

    ![](/images/集群压力测试/150线程/测试后/服务器1/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 服务器2

    ![](/images/集群压力测试/150线程/测试后/服务器2/堆内存信息.png)

    - 堆内存使用：400MB以下
    - 非堆内存使用：150MB以下

    

  - 服务器3

    ![](/images/集群压力测试/150线程/测试后/服务器3/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 小结

    测试过程中，堆内存使用虽有变化，但还算稳定，且整体内存占用都不高。

    

- ECS服务器信息

  - 服务器1

  ![](/images/集群压力测试/150线程/测试后/服务器1/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 10 MB/S 以下

  ​		3、网络带宽（出）：15 MB/S 以下

  

  - 服务器2

  ![](/images/集群压力测试/150线程/测试后/服务器2/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 服务器3

  ![](/images/集群压力测试/150线程/测试后/服务器3/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 小结

    ​	测试过程中，三台服务器的CPU使用率都在50%以下，而网络带宽方面，因Nginx运行在服务器1，所以服务器1的带宽使用较高，但也都在服务器的承受范围之内。

    

- JMeter测试结果

![](/images/集群压力测试/150线程/聚合报告.png)

说明：

​	1、样本数：15万

​	2、平均响应时间：844 毫秒

​	3、吞吐量：152 次/秒

​	4、请求异常：0



### 4、200线程

- URL信息

  - 服务器1

  ![](/images/集群压力测试/200线程/测试后/服务器1/URL信息.png)

  说明：

  ​	1、请求次数：40010

  ​	2、请求时间和：335930

  ​	3、最大并发数：4

  

  - 服务器2

  ![](/images/集群压力测试/200线程/测试后/服务器2/URL信息.png)

  说明：

  ​	1、请求次数：80012

  ​	2、请求时间和：18085713

  ​	3、最大并发数：16

  

  - 服务器3

  ![](/images/集群压力测试/200线程/测试后/服务器3/URL信息.png)

  说明：

  ​	1、请求次数：80008

  ​	2、请求时间和：20750472

  ​	3、最大并发数：16

  

  - 小结

    1、请求次数和：200030

    2、请求时间和：39172115

    3、单服务器最高并发：16

    4、平均请求耗时：39172115/200030=195.83 毫秒

    

- 运行线程信息

  - 服务器1

  ![](/images/集群压力测试/200线程/测试后/服务器1/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：42

  ​			2、守护线程数：19

  ​			3、最大活跃线程数：46

  

  - 服务器2

  ![](/images/集群压力测试/200线程/测试后/服务器2/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：46

  

  - 服务器3

  ![](/images/集群压力测试/200线程/测试后/服务器3/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：46

  

  - 小结

    各服务器运行线程数据基本一致，且都不高，服务器的负载均衡效果良好。

    

- CPU信息

  - 服务器1

  ![](/images/集群压力测试/200线程/测试后/服务器1/CPU信息.png)

  ​		说明：

  ​			1、PID：14483

  ​			2、当前CPU使用率：4%

  - 服务器2

  ![](/images/集群压力测试/200线程/测试后/服务器2/CPU信息.png)

  ​		说明：

  ​			1、PID：13843

  ​			2、当前CPU使用率：2%

  - 服务器3

  ![](/images/集群压力测试/200线程/测试后/服务器3/CPU信息.png)

  ​		说明：

  ​			1、PID：14483

  ​			2、当前CPU使用率：3%

  - 小结

    测试完成后，各服务器CPU使用率都降下来了。

    

- 堆内存使用

  - 服务器1

    ![](/images/集群压力测试/200线程/测试后/服务器1/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 服务器2

    ![](/images/集群压力测试/200线程/测试后/服务器1/堆内存信息.png)

    - 堆内存使用：400MB以下
    - 非堆内存使用：150MB以下

    

  - 服务器3

    ![](/images/集群压力测试/200线程/测试后/服务器1/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 小结

    测试过程中，堆内存使用虽有变化，但还算稳定，且整体内存占用都不高。

    

- ECS服务器信息

  - 服务器1

  ![](/images/集群压力测试/200线程/测试后/服务器1/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 10 MB/S 以下

  ​		3、网络带宽（出）：15 MB/S 以下

  

  - 服务器2

  ![](/images/集群压力测试/200线程/测试后/服务器2/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 服务器3

  ![](/images/集群压力测试/200线程/测试后/服务器3/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 小结

    ​	测试过程中，三台服务器的CPU使用率都在50%以下，而网络带宽方面，因Nginx运行在服务器1，所以服务器1的带宽使用较高，但也都在服务器的承受范围之内。

    

- JMeter测试结果

![](/images/集群压力测试/200线程/聚合报告.png)

说明：

​	1、样本数：20万

​	2、平均响应时间：1142 毫秒

​	3、吞吐量：148.7次/秒

​	4、请求异常：0

### 5、300线程

- URL信息

  - 服务器1

  ![](/images/集群压力测试/300线程/测试后/服务器1/URL信息.png)

  说明：

  ​	1、请求次数：120010

  ​	2、请求时间和：1059555

  ​	3、最大并发数：6

  

  - 服务器2

  ![](/images/集群压力测试/300线程/测试后/服务器2/URL信息.png)

  说明：

  ​	1、请求次数：240008

  ​	2、请求时间和：60552906

  ​	3、最大并发数：16

  

  - 服务器3

  ![](/images/集群压力测试/300线程/测试后/服务器3/URL信息.png)

  说明：

  ​	1、请求次数：240012

  ​	2、请求时间和：53632512

  ​	3、最大并发数：16

  

  - 小结

    1、请求次数和：600030

    2、请求时间和：114294973

    3、单服务器最高并发：16

    4、平均请求耗时：114294973/600030=190.48 毫秒

    

- 运行线程信息

  - 服务器1

  ![](/images/集群压力测试/300线程/测试后/服务器1/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：45

  

  - 服务器2

  ![](/images/集群压力测试/300线程/测试后/服务器2/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：43

  ​			2、守护线程数：20

  ​			3、最大活跃线程数：46

  

  - 服务器3

  ![](/images/集群压力测试/300线程/测试后/服务器3/线程信息.png)

  ​		说明：

  ​			1、活跃线程数：42

  ​			2、守护线程数：19

  ​			3、最大活跃线程数：45

  

  - 小结

    各服务器运行线程数据基本一致，且都不高，服务器的负载均衡效果良好。

    

- CPU信息

  - 服务器1

  ![](/images/集群压力测试/300线程/测试后/服务器1/CPU信息.png)

  ​		说明：

  ​			1、PID：14921

  ​			2、当前CPU使用率：13%

  - 服务器2

  ![](/images/集群压力测试/300线程/测试后/服务器2/CPU信息.png)

  ​		说明：

  ​			1、PID：14281

  ​			2、当前CPU使用率：2%

  - 服务器3

  ![](/images/集群压力测试/300线程/测试后/服务器3/CPU信息.png)

  ​		说明：

  ​			1、PID：14282

  ​			2、当前CPU使用率：3%

  - 小结

    测试完成后，各服务器CPU使用率都降下来了。

    

- 堆内存使用

  - 服务器1

    ![](/images/集群压力测试/300线程/测试后/服务器1/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 服务器2

    ![](/images/集群压力测试/300线程/测试后/服务器2/堆内存信息.png)

    - 堆内存使用：400MB以下
    - 非堆内存使用：150MB以下

    

  - 服务器3

    ![](/images/集群压力测试/300线程/测试后/服务器3/堆内存信息.png)

    - 堆内存使用：400MB以下

    - 非堆内存使用：150MB以下

      

  - 小结

    测试过程中，堆内存使用虽有变化，但还算稳定，且整体内存占用都不高。

    

- ECS服务器信息

  - 服务器1

  ![](/images/集群压力测试/300线程/测试后/服务器1/ECS信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 10 MB/S 以下

  ​		3、网络带宽（出）：15 MB/S 以下

  

  - 服务器2

  ![](/images/集群压力测试/300线程/测试后/服务器2/堆内存信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 服务器3

  ![](/images/集群压力测试/300线程/测试后/服务器3/堆内存信息.png)

  说明：

  ​		1、CPU使用率：50% 以下

  ​		2、网络带宽（入）： 5 MB/S 以下

  ​		3、网络带宽（出）： 5 MB/S 以下

  

  - 小结

    ​	测试过程中，三台服务器的CPU使用率都在50%以下，而网络带宽方面，因Nginx运行在服务器1，所以服务器1的带宽使用较高，但也都在服务器的承受范围之内。

    

- JMeter测试结果

![](/images/集群压力测试/300线程/聚合报告.png)

说明：

​	1、样本数：60万

​	2、平均响应时间：1769 毫秒

​	3、吞吐量：155 次/秒

​	4、请求异常：0



# 五、汇总分析与总结

## 1、数据汇总

### 1、测试时间

| **线程组线程数（个）** | **测试开始时间**     |   **并发记录时间**   | **测试结束时间**     | **测试总耗时（秒）** |
| ---------------------- | -------------------- | :------------------: | -------------------- | :------------------: |
| **50**                 | 2019年5月5日13:18:41 | 2019年5月5日13:19:45 | 2019年5月5日13:25:02 |         381          |
| **100**                | 2019年5月5日14:11:02 | 2019年5月5日14:13:12 | 2019年5月5日14:22:27 |         685          |
| **150**                | 2019年5月5日14:33:25 | 2019年5月5日14:36:14 | 2019年5月5日14:49:52 |         987          |
| **200**                | 2019年5月5日15:02:17 | 2019年5月5日15:05:40 | 2019年5月5日15:24:41 |         1344         |
| **300**                | 2019年5月5日15:45:37 | 2019年5月5日15:50:43 | 2019年5月5日16:49:57 |         3860         |

### 2、Meter聚合报告相关数据

| **线程组线程数（个）** | **请求样本数（次）** | **平均响应时间（毫秒）** | 吞吐量（次/秒） | 请求失败率（%） |
| :--------------------: | :------------------: | :----------------------: | :-------------: | :-------------: |
|         **50**         |        50000         |           328            |      131.5      |        0        |
|        **100**         |        100000        |           590            |      146.1      |        0        |
|        **150**         |        150000        |           844            |      152.0      |        0        |
|        **200**         |        200000        |           1142           |      148.7      |        0        |
|        **300**         |        600000        |           1769           |      145.1      |        0        |

### 3、Druid数据源监控数据

数据都已经过处理，都是是期间的，即将测试后的数据减去测试前的数据所得。

| **线程组线程数（个）** | **服务器** | URI请求数（次） | URI请求时间和（毫秒） | URI最大并发数（个） |
| :--------------------: | :--------: | :-------------: | :-------------------: | :-----------------: |
|         **50**         |  服务器1   |      10000      |        105257         |          5          |
|         **50**         |  服务器2   |      20000      |        4560471        |         16          |
|         **50**         |  服务器3   |      20000      |        5338819        |         16          |
|        **100**         |  服务器1   |      20000      |        187584         |          4          |
|        **100**         |  服务器2   |      39999      |        9632677        |         16          |
|        **100**         |  服务器3   |      40001      |       10290647        |         16          |
|        **150**         |  服务器1   |      30000      |        245926         |          5          |
|        **150**         |  服务器2   |      60000      |       13358937        |         16          |
|        **150**         |  服务器3   |      60000      |       15132666        |         16          |
|        **200**         |  服务器1   |      40000      |        335193         |          4          |
|        **200**         |  服务器2   |      80002      |       18081878        |         16          |
|        **200**         |  服务器3   |      79998      |       20746349        |         16          |
|        **300**         |  服务器1   |     120000      |        1058805        |          6          |
|        **300**         |  服务器2   |     239998      |       60548308        |         16          |
|        **300**         |  服务器3   |     240002      |       53628115        |         16          |

#### 4、SpringBootAdmin监控数据

接口压力测试是不同线程组的多次测试，每个线程组都有自己的ECS监控图，图片较多，就不再一一展示，每个线程组的ECS监控数据如表所示。

| 线程组线程数（个） | 服务器  | CPU最高使用率（%） | 网络带宽最高使用-入方向（MB/S） | 网络带宽最高使用-出方向（MB/S） |
| :----------------: | :-----: | :----------------: | :-----------------------------: | :-----------------------------: |
|       **50**       | 服务器1 |      50 以下       |             10以下              |             接近15              |
|       **50**       | 服务器2 |        同上        |              5以下              |              5以下              |
|       **50**       | 服务器3 |        同上        |              5以下              |              5以下              |
|      **100**       | 服务器1 |        同上        |             10以下              |             接近15              |
|      **100**       | 服务器2 |        同上        |              5以下              |              5以下              |
|      **100**       | 服务器3 |        同上        |              5以下              |              5以下              |
|      **150**       | 服务器1 |        同上        |             10以下              |             接近15              |
|      **150**       | 服务器2 |        同上        |              5以下              |              5以下              |
|      **150**       | 服务器3 |        同上        |              5以下              |              5以下              |
|      **200**       | 服务器1 |        同上        |             10以下              |             接近15              |
|      **200**       | 服务器2 |        同上        |              5以下              |              5以下              |
|      **200**       | 服务器3 |        同上        |              5以下              |              5以下              |
|      **300**       | 服务器1 |        同上        |             10以下              |             接近15              |
|      **300**       | 服务器2 |        同上        |              5以下              |              5以下              |
|      **300**       | 服务器3 |        同上        |              5以下              |              5以下              |

## 2、性能分析

### 1、测试耗时分析

测试耗时随着线程组线程数的增多而增多，但最高耗时的300线程，平均每次访问耗时也才6.43毫秒，速度非常快。

### 2、 JMeter聚合报告数据分析

平均响应时间随线程组线程数的增多而增大，而吞吐量在线程组线程数为150时达到最高，最高吞吐量为152次/秒，线程数再增加吞吐量会下降，当线程组线程数达到300时，被测接口的平均响应时间超过1秒，说明被测接口存在并发访问性能瓶颈，影响系统并发承载量。

### 3、 Druid监控数据分析

URI请求耗时随线程组线程数的增大而增大，但在各个服务器中，URI的最大并发数却一直是16，无法再提升，说明被测接口还存在并发访问性能瓶颈。

### 4、ECS服务器监控数据

- 测试过程中，各服务器的CPU使用率都在50%以下，对测试影响不大。
- 测试过程中，服务器2与服务器3的网络带宽使用都不高，但因Nginx部署在服务器1上，所有请求的进出都要经过服务器1，所以服务器1的网络带宽使用较高，入方向还好，但出方向已接近极限的15MB/S，可能会成为性能瓶颈。

## 3、测试总结

①  被测接口响应速度很快，但随着访问线程数的增多，响应速度会降低。

②  URI请求耗时随线程组线程数的增大而增大，但各个服务器的URI最大并发量只能到16，不再增加。

③  各线程组在测试过程中，各服务器的CPU使用没有问题，但服务器1的网络带宽使用较高，接近了极限。



# 六、异常处理

## 1、JMeter报错：Address already in use: connect

### 1、详细错误信息

- Json断言结果

  ```java
  JSON断言 : Expected to find an object with property ['code'] in path $ but found 'java.lang.String'. This is not a json object according to the JsonProvider: 'com.jayway.jsonpath.spi.json.JsonSmartJsonProvider'.
  ```

- JMeter报错

  ![](/images/集群压力测试/异常/异常-1.png)

- 服务器错误日志

  ```java
  无
  ```

### 2、异常分析

  经过查阅资料分析，这是因为windows本身提供的端口访问机制的问题，Windows 提供给 TCP/IP链接的端口为 1024-5000，并且要四分钟来循环回收他们。就导致我们在短时间内跑大量的请求时将端口占满了。

### 3、解决方法

```
1.cmd中，用regedit命令打开注册表
2.在 HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters下，
　　1 .右击parameters，添加一个新的DWORD，名字为MaxUserPort
　　2 .然后双击MaxUserPort，输入数值数据为65534，基数选择十进制（如果是分布式运行的话，控制机器和负载机器都需要这样操作）
　　3 .新建 DWORD值，name：TcpTimedWaitDe，value：30（十进制） ——> 设置为30秒（默认240）
3.修改配置完毕之后记得重启机器才会生效
```

参考资料：

​	[jmeter压力测试报错:java.net.BindException: Address already in use: connect](https://www.cnblogs.com/pgf622/articles/9109521.html)

​	[Address already in use : connect 的解决办法](https://blog.csdn.net/qq_31441637/article/details/80422901)



# 七、结语

此测试报告只是本人在做毕设时所做的一些测试手记，结构和内容不够严谨，且是本人在毕业一个月后才来整理的，整理时对过去做测试的一些相关测试数据已经记忆模糊，**所以手记可能会存在一些纰漏和问题，仅做测试和优化步骤的参考**，具体可参看本人的本科毕业论文：《面向高并发访问优化的内容管理系统》。